# Инструкция по деплою на Render

## Шаг 1: Подготовка базы данных

1. Зайдите на [Render](https://render.com) и создайте аккаунт
2. Создайте новую PostgreSQL базу данных:
   - Нажмите "New +" → "PostgreSQL"
   - Выберите план (Free план подойдет для начала)
   - Запишите внутренний URL базы данных (Internal Database URL)

## Шаг 2: Создание Web Service

1. Подключите ваш GitHub репозиторий к Render
2. Создайте новый Web Service:
   - Нажмите "New +" → "Web Service"
   - Выберите ваш репозиторий
   - Настройте следующие параметры:
     - **Name**: cybersportorg (или любое другое имя)
     - **Environment**: Node
     - **Build Command**: `npm install && npm run build`
     - **Start Command**: `npm start`
     - **Plan**: Free (или выберите другой план)

## Шаг 3: Настройка переменных окружения

Добавьте следующие переменные окружения в настройках вашего Web Service:

### Обязательные переменные:

1. **DATABASE_URL**
   - Используйте внутренний URL вашей PostgreSQL базы данных от Render
   - Формат: `postgresql://user:password@host:port/database?schema=public`
   - Это Internal Database URL из настроек вашей БД

2. **NEXTAUTH_URL**
   - URL вашего приложения на Render
   - Формат: `https://your-app-name.onrender.com`
   - Замените `your-app-name` на имя вашего сервиса

3. **NEXTAUTH_SECRET**
   - Сгенерируйте случайную строку
   - Можно использовать команду: `openssl rand -base64 32`
   - Или сгенерировать онлайн: https://generate-secret.vercel.app/32

### Дополнительные переменные:

4. **ADMIN_EMAIL**
   - Email администратора (по умолчанию: admin@cybersport.org)

5. **ADMIN_PASSWORD**
   - Пароль администратора (обязательно измените на безопасный!)

## Шаг 4: Деплой

1. Нажмите "Create Web Service"
2. Render начнет деплой вашего приложения
3. Дождитесь завершения сборки (это может занять несколько минут)

## Шаг 5: Инициализация базы данных

После первого успешного деплоя:

1. Подключитесь к вашему сервису через Render Shell:
   - Откройте ваш Web Service
   - Перейдите в раздел "Shell"
   - Выполните следующие команды:

```bash
# Применить схему базы данных
npx prisma db push

# Создать администратора
npm run db:seed
```

Или используйте Render Console для выполнения команд.

## Шаг 6: Проверка

1. Откройте ваш сайт по URL, указанному в Render
2. Войдите используя учетные данные администратора:
   - Email: тот, который вы указали в `ADMIN_EMAIL`
   - Пароль: тот, который вы указали в `ADMIN_PASSWORD`

## Решение проблем

### Ошибка подключения к базе данных

- Убедитесь, что используете **Internal Database URL**, а не внешний
- Проверьте, что база данных запущена
- Убедитесь, что переменная `DATABASE_URL` правильно настроена

### Ошибки при сборке

- Проверьте логи сборки в Render
- Убедитесь, что все зависимости установлены
- Проверьте, что версия Node.js совместима (Render использует Node 18+)

### Проблемы с аутентификацией

- Убедитесь, что `NEXTAUTH_URL` указывает на правильный URL
- Проверьте, что `NEXTAUTH_SECRET` установлен
- Убедитесь, что база данных инициализирована

## Автоматический деплой

Render автоматически развертывает ваше приложение при каждом push в основную ветку (main/master). Вы можете настроить это в настройках сервиса.

## Обновление приложения

После каждого обновления кода:
1. Сделайте commit и push в репозиторий
2. Render автоматически начнет новую сборку
3. После завершения сборки приложение будет обновлено

## Мониторинг

- Используйте вкладку "Logs" для просмотра логов приложения
- Используйте "Metrics" для мониторинга производительности
- Настройте уведомления о проблемах в настройках сервиса

## Безопасность

- Никогда не коммитьте файл `.env` в репозиторий
- Используйте сильные пароли для администратора
- Регулярно обновляйте зависимости
- Используйте HTTPS (Render предоставляет это автоматически)

