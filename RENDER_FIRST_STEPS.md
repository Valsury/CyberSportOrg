# Первые шаги для деплоя на Render

## Шаг 1: Создание PostgreSQL базы данных на Render

### 1.1. Зайдите на Render
1. Откройте https://render.com
2. Войдите в свой аккаунт (или создайте новый, если его нет)

### 1.2. Создайте PostgreSQL базу данных
1. Нажмите кнопку **"New +"** в правом верхнем углу
2. Выберите **"PostgreSQL"**
3. Заполните форму:
   - **Name**: `cybersportorg-db` (или любое другое имя)
   - **Database**: `cybersportorg` (или оставьте значение по умолчанию)
   - **User**: оставьте значение по умолчанию
   - **Region**: выберите ближайший регион (например, `Frankfurt (EU)` или `Oregon (US West)`)
   - **PostgreSQL Version**: выберите последнюю версию (обычно `16`)
   - **Plan**: выберите **Free** (для тестирования) или **Starter** (для production)
4. Нажмите **"Create Database"**

### 1.3. Сохраните Internal Database URL
1. После создания базы данных, откройте её настройки
2. Найдите раздел **"Connections"**
3. Скопируйте **Internal Database URL** (он выглядит примерно так: `postgresql://user:password@dpg-xxxxx-a/cybersportorg`)
   - ⚠️ **ВАЖНО**: Используйте Internal Database URL, а не External Database URL
   - Internal URL работает только внутри сети Render и быстрее
4. Сохраните этот URL - он понадобится на следующем шаге

## Шаг 2: Подготовка репозитория (если еще не сделано)

### 2.1. Убедитесь, что код в Git
```bash
git status
```

### 2.2. Если репозитория нет, создайте его
```bash
git init
git add .
git commit -m "Initial commit"
```

### 2.3. Создайте репозиторий на GitHub
1. Зайдите на https://github.com
2. Создайте новый репозиторий
3. Следуйте инструкциям для подключения локального репозитория

### 2.4. Запушьте код
```bash
git remote add origin <ваш-github-repo-url>
git branch -M main
git push -u origin main
```

## Шаг 3: Создание Web Service на Render

### 3.1. Создайте новый Web Service
1. На Render нажмите **"New +"**
2. Выберите **"Web Service"**
3. Выберите **"Connect GitHub"** (или GitLab, если используете его)
4. Авторизуйте Render для доступа к вашим репозиториям
5. Выберите репозиторий `CyberSportOrg`

### 3.2. Настройте Web Service
Заполните форму:
- **Name**: `cybersportorg` (или любое другое имя)
- **Region**: выберите тот же регион, что и для базы данных
- **Branch**: `main` (или ваша основная ветка)
- **Root Directory**: оставьте пустым (если проект в корне)
- **Runtime**: `Node`
- **Build Command**: `npm install && npm run build`
- **Start Command**: `npm start`
- **Plan**: выберите **Free** (для тестирования) или **Starter** (для production)

### 3.3. Настройте переменные окружения
В разделе **"Environment Variables"** добавьте:

1. **DATABASE_URL**
   - Значение: Internal Database URL из шага 1.3
   - ⚠️ Используйте Internal Database URL!

2. **NEXTAUTH_URL**
   - Значение: `https://your-app-name.onrender.com`
   - Замените `your-app-name` на имя вашего сервиса
   - Или оставьте пустым и Render автоматически установит после деплоя

3. **NEXTAUTH_SECRET**
   - Значение: сгенерируйте случайную строку
   - Можно использовать: `openssl rand -base64 32`
   - Или онлайн генератор: https://generate-secret.vercel.app/32

4. **ADMIN_EMAIL**
   - Значение: `admin@cybersport.org` (или ваш email)

5. **ADMIN_PASSWORD**
   - Значение: придумайте надежный пароль
   - ⚠️ **НЕ ИСПОЛЬЗУЙТЕ** `admin123` в production!

### 3.4. Создайте сервис
Нажмите **"Create Web Service"**

## Шаг 4: Первый деплой и инициализация БД

### 4.1. Дождитесь завершения деплоя
Render автоматически:
- Установит зависимости
- Соберет приложение
- Запустит сервис

### 4.2. Инициализируйте базу данных
После успешного деплоя:

1. Откройте ваш Web Service на Render
2. Перейдите в раздел **"Shell"** (или используйте **"Logs"** для просмотра)
3. Откройте Shell и выполните команды:

```bash
# Применить схему базы данных
npx prisma db push

# Создать администратора
npm run db:seed
```

Или используйте Render Console для выполнения команд.

## Шаг 5: Проверка

1. Откройте ваш сайт по URL, который предоставил Render
2. Войдите используя:
   - Email: тот, который вы указали в `ADMIN_EMAIL`
   - Пароль: тот, который вы указали в `ADMIN_PASSWORD`

## Важные замечания

- ⚠️ **Используйте Internal Database URL** для DATABASE_URL (не External)
- ⚠️ **Измените ADMIN_PASSWORD** на надежный пароль для production
- ⚠️ **Не коммитьте** файл `.env` в репозиторий
- ⚠️ Free план Render может "засыпать" после неактивности - это нормально

## Решение проблем

### Ошибка подключения к БД
- Убедитесь, что используете Internal Database URL
- Проверьте, что база данных запущена
- Убедитесь, что переменная DATABASE_URL правильно настроена

### Ошибки при сборке
- Проверьте логи сборки в Render
- Убедитесь, что все зависимости установлены
- Проверьте версию Node.js (Render использует Node 18+)

### Проблемы с аутентификацией
- Убедитесь, что NEXTAUTH_URL указывает на правильный URL
- Проверьте, что NEXTAUTH_SECRET установлен
- Убедитесь, что база данных инициализирована

## Следующие шаги

После успешного деплоя:
1. Настройте домен (опционально)
2. Настройте автоматические бэкапы базы данных
3. Настройте мониторинг и алерты
4. Рассмотрите upgrade на платный план для production

